import { BaseSkill } from './base-skill.js';
import { IntentType, RiskLevel, } from '../types/index.js';
/**
 * Proof Skill - Generates receipts and proof of transactions
 *
 * "Show me a receipt"
 *
 * Takes: Transaction hash or recent transaction reference
 * Returns: Human-readable, shareable receipt with verification link
 */
export class ProofSkill extends BaseSkill {
    name = 'proof';
    description = 'Generates receipts and proof of blockchain transactions';
    handledIntents = [IntentType.PROOF];
    async validate(context) {
        const { entities } = context.intent;
        // Need a transaction to generate proof for
        if (entities.transactionHashes.length === 0) {
            // Check if they might be referring to a recent transaction
            const message = context.originalMessage.toLowerCase();
            const refersToRecent = message.includes('last') ||
                message.includes('recent') ||
                message.includes('previous') ||
                message.includes('that');
            if (!refersToRecent) {
                return {
                    valid: false,
                    error: 'Please provide a transaction hash or specify which transaction you need a receipt for.',
                };
            }
        }
        return { valid: true };
    }
    async execute(context) {
        const { entities } = context.intent;
        // TODO: Implement actual transaction lookup
        // TODO: Generate proper receipt with on-chain data
        const txHash = entities.transactionHashes[0] ||
            '0x' + '1234'.repeat(16); // Mock hash for "recent" tx
        // Mock transaction data (would come from explorer API)
        const txData = {
            hash: txHash,
            from: '0xSender123...abc',
            to: '0xReceiver456...def',
            value: '0.5 ETH',
            valueUSD: '$1,250.00',
            timestamp: new Date().toISOString(),
            blockNumber: 18500000,
            status: 'confirmed',
            gasUsed: '21000',
            gasFee: '0.00126 ETH',
            network: 'Ethereum Mainnet',
        };
        // Generate receipt
        const receipt = this.generateReceipt(txData);
        return this.success({
            type: 'transaction_receipt',
            transaction: txData,
            receipt: {
                text: receipt.text,
                formatted: receipt.formatted,
            },
            verification: {
                explorerUrl: `https://etherscan.io/tx/${txHash}`,
                blockNumber: txData.blockNumber,
                confirmations: 50,
                verified: true,
            },
            shareable: {
                text: receipt.shareable,
                link: `https://etherscan.io/tx/${txHash}`,
            },
            exportFormats: ['text', 'pdf', 'image'],
        }, {
            riskLevel: RiskLevel.LOW,
            confidence: 0.95,
        });
    }
    generateReceipt(tx) {
        const date = new Date(tx.timestamp).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
        });
        const text = `
TRANSACTION RECEIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Date: ${date}
Network: ${tx.network}
Status: ${tx.status.toUpperCase()}

From: ${tx.from}
To: ${tx.to}

Amount: ${tx.value} (${tx.valueUSD})
Fee: ${tx.gasFee}

Transaction Hash:
${tx.hash}

Block: ${tx.blockNumber}
Confirmations: 50+

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Verify: etherscan.io/tx/${tx.hash.slice(0, 20)}...
Generated by Relay
    `.trim();
        const formatted = {
            header: 'ğŸ§¾ Transaction Receipt',
            status: `âœ… ${tx.status.toUpperCase()}`,
            amount: `ğŸ’° ${tx.value} (${tx.valueUSD})`,
            from: `ğŸ“¤ From: ${tx.from.slice(0, 8)}...${tx.from.slice(-6)}`,
            to: `ğŸ“¥ To: ${tx.to.slice(0, 8)}...${tx.to.slice(-6)}`,
            date: `ğŸ“… ${date}`,
            fee: `â›½ Fee: ${tx.gasFee}`,
            verify: `ğŸ”— Verify on Etherscan`,
        };
        const shareable = `Payment confirmed! ${tx.value} (${tx.valueUSD}) sent on ${date}. Verify: etherscan.io/tx/${tx.hash.slice(0, 20)}...`;
        return {
            text,
            formatted: JSON.stringify(formatted, null, 2),
            shareable,
        };
    }
}
//# sourceMappingURL=proof.skill.js.map